<!doctype html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0">
    <title>Яндекс.Дом</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <link rel="stylesheet" type="text/css" href="reset.css">
    <link rel="stylesheet" type="text/css" href="styles.css">
</head>
<body>

<div id="app"></div>

<footer class="footer">
    <ul class="footer__list">
        <li class="footer__item"><a class="footer__link" href="/">Помощь</a></li>
        <li class="footer__item"><a class="footer__link" href="/">Обратная связь</a></li>
        <li class="footer__item"><a class="footer__link" href="/">Разработчикам</a></li>
        <li class="footer__item"><a class="footer__link" href="/">Условия использования</a></li>
    </ul>
    <div class="footer__copyright">© 1997–2023 ООО «Яндекс»</div>
</footer>

<script type="text/javascript">
    const e = React.createElement;

    function Header() {
        const [expanded, setExpanded] = React.useState(false);
        const [toggled, setToggled] = React.useState(false);

        const onClick = () => {
            if (!toggled) setToggled(true);
            setExpanded(!expanded);
        };

        const linksClass =
            'header__links' +
            (expanded ? ' header__links_opened' : '') +
            (toggled  ? ' header__links-toggled' : '');

        return e('header', { className: 'header' },
            e('a', { href: '/', className: 'header__logo', 'aria-label': 'Яндекс.Дом' }),
            e('button', {
                className: 'header__menu',
                'aria-expanded': expanded ? 'true' : 'false',
                onClick
            },
                e('span', { className: 'header__menu-text a11y-hidden' },
                    expanded ? 'Закрыть меню' : 'Открыть меню'
                )
            ),
            e('ul', { className: linksClass },
                e('li', { className: 'header__item' },
                    e('a', {
                        className: 'header__link header__link_current',
                        href: '/',
                        'aria-current': 'page'
                    }, 'Сводка')
                ),
                e('li', { className: 'header__item' },
                    e('a', { className: 'header__link', href: '/devices' }, 'Устройства')
                ),
                e('li', { className: 'header__item' },
                    e('a', { className: 'header__link', href: '/scripts' }, 'Сценарии')
                )
            )
        );
    }

    function Event(props) {
        const ref = React.useRef();
        const { onSize, slim, icon, iconLabel, title, subtitle } = props;

        React.useEffect(() => {
            const { offsetWidth: width, offsetHeight: height } = ref.current;
            if (onSize) onSize({ width, height });
        });

        return e('li', {
            ref,
            className: 'event' + (slim ? ' event_slim' : '')
        },
            e('button', { className: 'event__button' },
                e('span', {
                    className: `event__icon event__icon_${icon}`,
                    role: 'img',
                    'aria-label': iconLabel
                }),
                e('h4', { className: 'event__title' }, title),
                subtitle && e('span', { className: 'event__subtitle' }, subtitle)
            )
        );
    }

    // Данные вкладок
    const TABS = {
        all: {
            title: 'Все',
            items: [{
                icon: 'light2',
                iconLabel: 'Освещение',
                title: 'Xiaomi Yeelight LED Smart Bulb',
                subtitle: 'Включено'
            }, {
                icon: 'light',
                iconLabel: 'Освещение',
                title: 'D-Link Omna 180 Cam',
                subtitle: 'Включится в 17:00'
            }, {
                icon: 'temp',
                iconLabel: 'Температура',
                title: 'Elgato Eve Degree Connected',
                subtitle: 'Выключено до 17:00'
            }, {
                icon: 'light',
                iconLabel: 'Освещение',
                title: 'LIFX Mini Day & Dusk A60 E27',
                subtitle: 'Включится в 17:00'
            }, {
                icon: 'light2',
                iconLabel: 'Освещение',
                title: 'Xiaomi Mi Air Purifier 2S',
                subtitle: 'Включено'
            }, {
                icon: 'light',
                iconLabel: 'Освещение',
                title: 'Philips Zhirui',
                subtitle: 'Включено'
            }, {
                icon: 'light',
                iconLabel: 'Освещение',
                title: 'Philips Zhirui',
                subtitle: 'Включено'
            }, {
                icon: 'light2',
                iconLabel: 'Освещение',
                title: 'Xiaomi Mi Air Purifier 2S',
                subtitle: 'Включено'
            }]
        },
        kitchen: {
            title: 'Кухня',
            items: [{
                icon: 'light2',
                iconLabel: 'Освещение',
                title: 'Xiaomi Yeelight LED Smart Bulb',
                subtitle: 'Включено'
            }, {
                icon: 'temp',
                iconLabel: 'Температура',
                title: 'Elgato Eve Degree Connected',
                subtitle: 'Выключено до 17:00'
            }]
        },
        hall: {
            title: 'Зал',
            items: [{
                icon: 'light',
                iconLabel: 'Освещение',
                title: 'Philips Zhirui',
                subtitle: 'Выключено'
            }, {
                icon: 'light2',
                iconLabel: 'Освещение',
                title: 'Xiaomi Mi Air Purifier 2S',
                subtitle: 'Выключено'
            }]
        },
        lights: {
            title: 'Лампочки',
            items: [{
                icon: 'light',
                iconLabel: 'Освещение',
                title: 'D-Link Omna 180 Cam',
                subtitle: 'Включится в 17:00'
            }, {
                icon: 'light',
                iconLabel: 'Освещение',
                title: 'LIFX Mini Day & Dusk A60 E27',
                subtitle: 'Включится в 17:00'
            }, {
                icon: 'light2',
                iconLabel: 'Освещение',
                title: 'Xiaomi Mi Air Purifier 2S',
                subtitle: 'Включено'
            }, {
                icon: 'light',
                iconLabel: 'Освещение',
                title: 'Philips Zhirui',
                subtitle: 'Включено'
            }]
        },
        cameras: {
            title: 'Камеры',
            items: [{
                icon: 'light2',
                iconLabel: 'Освещение',
                title: 'Xiaomi Mi Air Purifier 2S',
                subtitle: 'Включено'
            }]
        }
    };
    const TABS_KEYS = Object.keys(TABS);
    // Дополнительное дублирование для нагрузки
    for (let i = 0; i < 6; i++) {
        TABS.all.items = [...TABS.all.items, ...TABS.all.items];
    }

    function Main() {
        const ref = React.useRef();
        const initedRef = React.useRef(false);
        const [activeTab, setActiveTab] = React.useState('');
        const [hasRightScroll, setHasRightScroll] = React.useState(false);
        let sizes = [];

        React.useEffect(() => {
            if (!activeTab && !initedRef.current) {
                initedRef.current = true;
                const params = new URLSearchParams(location.search);
                setActiveTab(params.get('tab') || 'all');
            }
        });

        const onSelect = evt => setActiveTab(evt.target.value);
        const onSize = size => { sizes.push(size); };

        React.useEffect(() => {
            const sumW = sizes.reduce((a, x) => a + x.width, 0);
            const newScroll = sumW > ref.current.offsetWidth;
            if (newScroll !== hasRightScroll) setHasRightScroll(newScroll);
        });

        const scrollRight = () => {
            const panel = ref.current.querySelector('.section__panel:not(.section__panel_hidden)');
            if (panel) {
                panel.scrollTo({ left: panel.scrollLeft + 400, behavior: 'smooth' });
            }
        };

        return e('main', { className: 'main' },
            // Секция "Главное"
            e('section', { className: 'section main__general' },
                e('h2', { className: 'section__title section__title-header section__main-title' }, 'Главное'),
                e('div', { className: 'hero-dashboard' },
                    e('div', { className: 'hero-dashboard__primary' },
                        e('h3', { className: 'hero-dashboard__title' }, 'Привет, Геннадий!'),
                        e('p', { className: 'hero-dashboard__subtitle' }, 'Двери и окна закрыты, сигнализация включена.'),
                        e('ul', { className: 'hero-dashboard__info' },
                            e('li', { className: 'hero-dashboard__item' },
                                e('div', { className: 'hero-dashboard__item-title' }, 'Дома'),
                                e('div', { className: 'hero-dashboard__item-details' },
                                    '+23', e('span', { className: 'a11y-hidden' }, '°')
                                )
                            ),
                            e('li', { className: 'hero-dashboard__item' },
                                e('div', { className: 'hero-dashboard__item-title' }, 'За окном'),
                                e('div', { className: 'hero-dashboard__item-details' },
                                    '+19', e('span', { className: 'a11y-hidden' }, '°'),
                                    e('div', {
                                        className: 'hero-dashboard__icon hero-dashboard__icon_rain',
                                        role: 'img',
                                        'aria-label': 'Дождь'
                                    })
                                )
                            )
                        )
                    ),
                    e('ul', { className: 'hero-dashboard__schedule' },
                        e(Event, {
                            icon: 'temp', iconLabel: 'Температура',
                            title: 'Philips Cooler', subtitle: 'Начнет охлаждать в 16:30', onSize
                        }),
                        e(Event, {
                            icon: 'light', iconLabel: 'Освещение',
                            title: 'Xiaomi Yeelight LED Smart Bulb', subtitle: 'Включится в 17:00', onSize
                        }),
                        e(Event, {
                            icon: 'light', iconLabel: 'Освещение',
                            title: 'Xiaomi Yeelight LED Smart Bulb', subtitle: 'Включится в 17:00', onSize
                        })
                    )
                )
            ),
            // Секция "Сценарии"
            e('section', { className: 'section main__scripts' },
                e('h2', { className: 'section__title section__title-header' }, 'Избранные сценарии'),
                e('ul', { className: 'event-grid' },
                    e(Event, { slim: true, icon: 'light2', iconLabel: 'Освещение', title: 'Выключить весь свет в доме и во дворе', onSize }),
                    e(Event, { slim: true, icon: 'schedule', iconLabel: 'Расписание', title: 'Я ухожу', onSize }),
                    e(Event, { slim: true, icon: 'light2', iconLabel: 'Освещение', title: 'Включить свет в коридоре', onSize }),
                    e(Event, { slim: true, icon: 'temp2', iconLabel: 'Температура', title: 'Набрать горячую ванну', subtitle: 'Начнётся в 18:00', onSize }),
                    e(Event, { slim: true, icon: 'temp2', iconLabel: 'Температура', title: 'Сделать пол тёплым во всей квартире', onSize })
                )
            ),
            // Секция "Устройства"
            e('section', { className: 'section main__devices' },
                e('div', { className: 'section__title' },
                    e('h2', { className: 'section__title-header' }, 'Избранные устройства'),
                    e('select', { className: 'section__select', defaultValue: 'all', onInput: onSelect },
                        ...TABS_KEYS.map(key =>
                            e('option', { key, value: key }, TABS[key].title)
                        )
                    ),
                    e('ul', { role: 'tablist', className: 'section__tabs' },
                        ...TABS_KEYS.map(key =>
                            e('li', {
                                key,
                                role: 'tab',
                                'aria-selected': key === activeTab ? 'true' : 'false',
                                tabIndex: key === activeTab ? 0 : undefined,
                                className: 'section__tab' + (key === activeTab ? ' section__tab_active' : ''),
                                id: `tab_${key}`,
                                'aria-controls': `panel_${key}`,
                                onClick: () => setActiveTab(key)
                            }, TABS[key].title)
                        )
                    )
                ),
                e('div', { className: 'section__panel-wrapper', ref },
                    ...TABS_KEYS.map(key =>
                        e('div', {
                            key,
                            role: 'tabpanel',
                            className: 'section__panel' + (key === activeTab ? '' : ' section__panel_hidden'),
                            'aria-hidden': key === activeTab ? 'false' : 'true',
                            id: `panel_${key}`,
                            'aria-labelledby': `tab_${key}`
                        },
                            e('ul', { className: 'section__panel-list' },
                                ...TABS[key].items.map((item, i) =>
                                    e(Event, { key: i, ...item, onSize })
                                )
                            )
                        )
                    ),
                    hasRightScroll && e('div', { className: 'section__arrow', onClick: scrollRight })
                )
            )
        );
    }

    // Рендерим
    const root = ReactDOM.createRoot(document.getElementById('app'));
    root.render(e(React.Fragment, null, e(Header), e(Main)));
</script>

</body>
</html>
